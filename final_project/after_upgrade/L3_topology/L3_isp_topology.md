## Описание топологии L3 и работы ядра сети
### Планирование IP адресации  

![][def]

[def]: https://github.com/bashkirov83/otus-gitnetwork/blob/main/final_project/after_upgrade/L3_topology/L3_%20isp_topology-L3.jpg  

Магистральные подсети  
|№ VLAN|Подсеть|Назначение|  
|-------|--------|----------|
  |398|10.3.98.0/29|подсеть Красноярск - Брянка - Северо-Енисейский|
  |3395|10.33.95.0/30|подсеть Красноярск - Северо-Енисейский,магистрал 1|
  |3850|10.38.50.0/30|подсеть Красноярск - Северо-Енисейский,магистрал 2|  
  
  Подсети ядра, Северо-Енисейский
  |№ VLAN|Подсеть|Назначение|
  |------|-------|----------|
  |100|10.100.100.0/30|линковка СКАТ-DPI с магистральным коммутатором|
  |145|10.168.145.0/24|подсеть управления коммутаторами и маршрутизаторами|
  |170|10.168.170.0/24|транспортная сеть между коммутаторами и маршрутизаторами0|
  |20X|10.168.20X.0/24|Сервисные подсети видеонаблюдение, телефония, управление обоурдованием доступа в поселках|
  |999-1998|100.64.0.0/20|подсеть абонентов vlan per user|
  |1999|172.16.0.0/20|подсеть абонентов PPPoE, выводится из эксплуатации|  

### Описание работы  

В качестве ядра сети выбраны коммутатры L3 SNR S300X-24FQ как наиболее производительное и бюджетное решение имеющее порты 10/40G, размер таблицы MAC 32000 и динамические протоколы маршрутизации. Коммутация и пропуск трафика на скорости порта, а также неблокируемая архитекутра обеспечат большую производительность и минимальные задержки за более низкую стоимость нежели реализация ядра на маршрутизаторах.

Маршуртизаторы Mikrotik обеспечивают стык BGP и анонисруют AS вышетоящему оператору, а так же обеспечивают L2-L3 VPN via MPLS и VXLAN для абонентов которым необходима такая услуга между городом и поселками.

Непосредственно в поселках установлены коммутаторы L3 серии SNR S2995-12-24G терминирующие абонентские подсети и выступающие шлюзами для абонентов и терминирующие абонентские S-VLAN и выполняют роль dhcp-relay.
Коммутаторы L2 GePON BDCOM реализуют схему QinQ vlan per user, s-vlan на GePON порт, c-vlan на пользователя. Дополнителный функционал на них не навешивался.

При попытке абонента выйти в сеть, запрос ip адреса прилетает на коммутатор L3 поселка и перенаправляется в ядро сети на S300X, откуда уходит на СКАТ-DPI выступающий в роли DHCP Proxy. СКАТ разбирает теги QinQ+MAC адрес и по протоколу RADIUS отправляет запрос на биллинг, который в свою очередь авторизует абонента и выдает опции необходимые СКАТу radius-accept, если абонент может получить достп в сеть. Либо radius-reject, если абонент не оплатил доступ.
Далее траифк абонента ухрит в ядро сети через магистралов в Красноярск и затем НАТится на втором СКАТ-DPI либо проходит прозрачно. если абоненту выдан белый адрес.
Так же параллельно по такой же схеме работает старая реализация авторизации по PPPoE, СКАТ выступает в роли PPPoE сервера.

### Описание топологии

Вся сеть имеет крайне простую реализацю для упрощения администрирования, ввиду низкой квалификации администраторов и небольшого масштаба.
Разделена на 3 зоны OSFP:
1. Магистральная зона, backbone - между Красноярском и Северо-Енисейским, связывает зоны города и поселков и обеспечивает ECMP балансировку трафика
2. Зона 1 и 2 состыкованы с  backbone и анонсируют маршруты абонентов и оборудования между красноярском и поселками
3. Все абонентские сервисы, видеонаблюение, телефония и тд работают в отдельных VRF для изоляции трафика

## Заключение
Благодаря курсу, топология инетрнет-провайдера была модифицирована и координально улучшена, снижено количество обращений по настройке оборудования и жалоб на нестабильную работу в 4 раза.
Произведена модернизаци по железу и техноголгиям. Улучшена карма и психологическое спокойствие инженеров )))  
На ближайший год запланирована реализация и запуск подключений по протоколу IPv6
### Примененные знания из курса:
1. Динамические протоколы маршрутизации
2. VLAN и безопасность.
3. Policy base routing
4. BGP, ораганизована AS
5. Настрены политики AAA
6. Для клиентов орагнизованы VPN и прочие сервисы
7. Еще учимся все автоматизировать